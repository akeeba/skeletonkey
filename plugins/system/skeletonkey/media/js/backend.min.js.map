{"version":3,"file":"backend.min.js","names":["window","document","Joomla","Error","handleUserListPage","options","getOptions","rows","querySelectorAll","length","forEach","elRow","elCells","userId","textContent","loginUsers","indexOf","elButtonGroups","elButtonGroup","elIcon","createElement","classList","add","setAttribute","elSpan","Text","_","elLink","dataset","userid","appendChild","handleLoginButtons","elButton","addEventListener","loginButtonClickHandler","e","preventDefault","currentUserId","currentTarget","paths","token","uri","concat","base","location","pathname","renderMessages","info","request","url","replace","toString","onSuccess","data","returnedData","JSON","parse","open","rootFull","error","onError"],"sources":["backend.js"],"sourcesContent":["/**\n * @package   Skeletonkey\n * @copyright Copyright (c)2022-2025 Nicholas K. Dionysopoulos\n * @license   GPLv3 or later\n */\n\n'use strict';\n\n((window, document) => {\n\tif (!window.Joomla)\n\t{\n\t\tthrow new Error('Joomla API was not properly initialised');\n\t}\n\n\tconst initSkeletonKey = () => {\n\t\thandleUserListPage();\n\t\thandleLoginButtons();\n\t}\n\n\tconst handleUserListPage = () => {\n\t\t// Get the user list rows\n\t\tconst options = Joomla.getOptions('plg_system_skeletonkey');\n\t\tconst rows    = document.querySelectorAll('table#userList>tbody tr');\n\n\t\t// No user rows? Nothing to do here.\n\t\tif (!rows || rows.length < 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// Iterate through all rows\n\t\trows.forEach((elRow) => {\n\t\t\t// Get the user ID\n\t\t\tconst elCells = elRow.querySelectorAll('td');\n\t\t\tconst userId  = elCells[elCells.length - 1].textContent * 1;\n\n\t\t\t// If we are not allowed to log in this user go away.\n\t\t\tif (options.loginUsers.indexOf(userId) === -1)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Find the button group which has the Add Note button\n\t\t\tconst elButtonGroups = elRow.querySelectorAll('th div.btn-group');\n\t\t\tconst elButtonGroup  = elButtonGroups[0];\n\n\t\t\t// Create the icon for the login button\n\t\t\tconst elIcon = document.createElement('span');\n\t\t\telIcon.classList.add('fa', 'fa-external-link-alt', 'pe-1');\n\t\t\telIcon.setAttribute('aria-hidden', 'true');\n\n\t\t\t// Create the text for the login button\n\t\t\tconst elSpan       = document.createElement('span');\n\t\t\telSpan.textContent = Joomla.Text._('PLG_SYSTEM_SKELETONKEY_BTN_LABEL');\n\n\t\t\t// Create the login button itseld\n\t\t\tconst elLink = document.createElement('button');\n\t\t\telLink.setAttribute('type', 'button');\n\t\t\telLink.dataset['userid'] = userId;\n\t\t\telLink.classList.add('btn', 'btn-dark', 'btn-sm', 'button-skeletonkey');\n\t\t\telLink.appendChild(elIcon);\n\t\t\telLink.appendChild(elSpan);\n\n\t\t\t// Append the login button to the button group, after the Add Note button\n\t\t\telButtonGroup.appendChild(elLink);\n\t\t});\n\t}\n\n\tconst handleLoginButtons = () => {\n\t\tdocument.querySelectorAll('.button-skeletonkey').forEach((elButton) => {\n\t\t\telButton.addEventListener('click', loginButtonClickHandler);\n\t\t})\n\t}\n\n\tconst loginButtonClickHandler = (e) => {\n\t\te.preventDefault();\n\n\t\tconst currentUserId = e.currentTarget.dataset['userid'];\n\n\t\tif (typeof currentUserId === 'undefined' || !currentUserId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst paths = Joomla.getOptions('system.paths');\n\t\tconst token = Joomla.getOptions('csrf.token');\n\t\tconst uri   = `${paths ? `${paths.base}/index.php` : window.location.pathname}?option=com_ajax&format=json&plugin=skeletonkey&group=system&user_id=%d${token ? `&${token}=1` : ''}`;\n\n\t\tJoomla.renderMessages({\n\t\t\tinfo: ['Making request...']\n\t\t});\n\n\t\tJoomla.request({\n\t\t\turl:       uri.replace('%d', currentUserId.toString()),\n\t\t\tonSuccess: (data, xhr) => {\n\t\t\t\tconst returnedData = JSON.parse(data).data;\n\n\t\t\t\tif (!returnedData || returnedData[0] === false)\n\t\t\t\t{\n\t\t\t\t\tJoomla.renderMessages({\n\t\t\t\t\t\terror: [Joomla.Text._('PLG_SYSTEM_SKELETONKEY_ERR_LOGINFAILED')]\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twindow.open(paths.rootFull, '_blank');\n\t\t\t},\n\t\t\tonError:   (xhr) => {\n\t\t\t\tJoomla.renderMessages({\n\t\t\t\t\terror: [Joomla.Text._('PLG_SYSTEM_SKELETONKEY_ERR_LOGINFAILED_AJAX')]\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tinitSkeletonKey();\n})(window, document);"],"mappings":"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","ignoreList":[]}