{"version":3,"file":"backend.min.js","names":["window","Joomla","Error","initSkeletonKey","options","getOptions","rows","document","querySelectorAll","length","forEach","elRow","elCells","userId","textContent","loginUsers","indexOf","elButtonGroups","elButtonGroup","elIcon","createElement","classList","add","setAttribute","elSpan","Text","_","elLink","appendChild","addEventListener","e","preventDefault","paths","token","uri","concat","base","location","pathname","renderMessages","info","request","url","replace","toString","onSuccess","data","returnedData","JSON","parse","open","rootFull","error","onError"],"sources":["backend.js"],"sourcesContent":["/**\n * @package   Skeletonkey\n * @copyright Copyright (c)2022-2024 Nicholas K. Dionysopoulos\n * @license   GPLv3 or later\n */\n\n'use strict';\n\nif (!window.Joomla)\n{\n\tthrow new Error('Joomla API was not properly initialised');\n}\n\nconst initSkeletonKey = () => {\n\t// Get the user list rows\n\tconst options = Joomla.getOptions('plg_system_skeletonkey');\n\tconst rows    = document.querySelectorAll('table#userList>tbody tr');\n\n\t// No user rows? Nothing to do here.\n\tif (!rows || rows.length < 1)\n\t{\n\t\treturn;\n\t}\n\n\t// Iterate through all of the rows\n\trows.forEach((elRow) => {\n\t\t// Get the user ID\n\t\tconst elCells = elRow.querySelectorAll('td');\n\t\tconst userId  = elCells[elCells.length - 1].textContent * 1;\n\n\t\t// If we are not allowed to log in this user go away.\n\t\tif (options.loginUsers.indexOf(userId) === -1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// Find the button group which has the Add Note button\n\t\tconst elButtonGroups = elRow.querySelectorAll('th div.btn-group');\n\t\tconst elButtonGroup  = elButtonGroups[0];\n\n\t\t// Create the icon for the login button\n\t\tconst elIcon = document.createElement('span');\n\t\telIcon.classList.add('fa','fa-external-link-alt');\n\t\telIcon.setAttribute('aria-hidden', 'true');\n\n\t\t// Create the text for the login button\n\t\tconst elSpan       = document.createElement('span');\n\t\telSpan.textContent = Joomla.Text._('PLG_SYSTEM_SKELETONKEY_BTN_LABEL');\n\n\t\t// Create the login button itseld\n\t\tconst elLink = document.createElement('button');\n\t\telLink.setAttribute('type', 'button');\n\t\telLink.classList.add('btn', 'btn-dark', 'btn-sm');\n\t\telLink.appendChild(elIcon);\n\t\telLink.appendChild(elSpan);\n\n\t\t// Create a special click event handler\n\t\telLink.addEventListener('click', (e) => {\n\t\t\te.preventDefault();\n\n\t\t\tconst paths = Joomla.getOptions('system.paths');\n\t\t\tconst token = Joomla.getOptions('csrf.token');\n\t\t\tconst uri   = `${paths ? `${paths.base}/index.php` : window.location.pathname}?option=com_ajax&format=json&plugin=skeletonkey&group=system&user_id=%d${token ? `&${token}=1` : ''}`;\n\n\t\t\tJoomla.renderMessages({\n\t\t\t\tinfo: ['Making request...']\n\t\t\t});\n\n\t\t\tJoomla.request({\n\t\t\t\turl:       uri.replace('%d', userId.toString()),\n\t\t\t\tonSuccess: (data, xhr) => {\n\t\t\t\t\tconst returnedData = JSON.parse(data).data;\n\n\t\t\t\t\tif (!returnedData || returnedData[0] === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tJoomla.renderMessages({\n\t\t\t\t\t\t\terror: [Joomla.Text._('PLG_SYSTEM_SKELETONKEY_ERR_LOGINFAILED')]\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\twindow.open(paths.rootFull, '_blank');\n\t\t\t\t},\n\t\t\t\tonError:   (xhr) => {\n\t\t\t\t\tJoomla.renderMessages({\n\t\t\t\t\t\terror: [Joomla.Text._('PLG_SYSTEM_SKELETONKEY_ERR_LOGINFAILED_AJAX')]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// Append the login button to the button group, after the Add Note button\n\t\telButtonGroup.appendChild(elLink);\n\t});\n}\n\ninitSkeletonKey();\n"],"mappings":"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","ignoreList":[]}